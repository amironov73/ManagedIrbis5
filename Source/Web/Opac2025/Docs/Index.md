# ДОКУМЕНТАЦИЯ

### Сущности

* ``Database`` - база данных ИРБИС64.

    * ``name`` - имя (идентификатор) базы данных, например, ``"ISTU"``.
    * ``description`` - описание базы данных в произвольной форме, например, ``"Учебники и задачники"``.

* ``Scenario`` - сценарий поиска по словарю базы данных ИРБИС64.

    * ``prefix`` - префикс, задающий поисковый атрибут, например ``"A="`` для поиска по авторам.
    * ``description`` - описание поискового атрибута в произвольной форме, например, ``"Поиск по автору"``.

    В общем случае для каждой базы данных может использоваться индивидуальный набор поисковых сценариев.

* ``Instance`` - ссылка на экземпляр книги (готовый к выдаче или находящийся на руках у читателя).

    * ``db`` - имя (идентификатор) базы данных, например, ``"ISTU"``.
    * ``book`` - код книги в базе данных, например, ``"AB12/456"``. Код книги может содержать различные символы, в т. ч. латиницу, кириллицу, цифры, скобки, косую черту и прочие.
    * ``number`` - инвентарный номер книги, например, ``"123456"``.

* ``Loan`` - книга на руках у читателя.

    * ``instance`` - объект: ссылка на экземпляр книги (см. выше).
    * ``description`` - библиографическое описание книги, например, ``"Теория машин и механизмов : учебник"``.
    * ``deadline`` - дата крайнего срока возврата книги, например, ``"2024-10-01T00:00:00+08:00"``.
    * ``prolongation`` - целое число - счетчик продлений книги, например, ``2``.

* ``Reader`` - читатель (пользователь библиотеки).

    * ``ticket`` - строка: номер читательского билета, например, ``"ABC1223"``. Разные категории читателей могут иметь читательские билеты с номерами разной длины и структуры.
    * ``name`` - ФИО читателя, например, ``"Иванов Иван Иванович"``.
    * ``mail`` - строка: e-mail для связи (может быть ``null``), например, ``"example@istu.edu``.
    * ``loans`` - массив объектов ``Loan`` (см. выше), содержащий перечень книг на руках у данного читателя. Может быть ``null`` или ``[]``, если у читателя нет задолженности.

* ``Exemplar`` - экземпляр книги (или другого документа) из фондов библиотеки.

    * ``number`` - строка: инвентарный номер экземпляра, например, ``"X12321"``. Инвентарный номер может содержать различные символы, в т. ч. латиницу, кириллицу, цифры, скобки, косую черту и прочие.
    * ``status`` - строка: статус данного экземпляра. Статус ``"0"`` означает доступность экземпляра для выдачи, остальные значения - недоступность по тем или иным причинам (например, книга находится на руках у читателя).
    * ``sigle`` - строка: место постоянного хранения экземпляра, например, ``"ФКХ"``.

* ``Book`` - книга (или другой документ) из фондов библиотеки.

    * ``id`` - идентификатор книги (шифр в базе данных), например, ``"QE112/211"``. Может содержать различные символы, в т. ч. латиницу, кириллицу, цифры, скобки, косую черту и прочие.
    * ``description`` - библиографическое описание книги, например, ``"Проектирование зданий : учебник"``.
    * ``cover`` - ссылка на изображение обложки (может быть ``null``).
    * ``exemplars`` - массив объектов ``Exemplar`` (см. выше) - экземпляры книги (включая как готовые к выдаче, так и находящиеся на руках у читателей).

### Статусы заказов

* ``new`` - свежесозданный заказ.
* ``ready`` - заказ готов к выдаче (передан на пункт обслуживания).
* ``done`` - заказ выполнен (выдан читателю на руки).
* ``cancelled`` - отменен читателем.
* ``error`` - ошибка (например, книга не найдена на полке)
* ``archived`` - архивированный (неактивный) заказ.

### Конечные точки

* ``GET databases`` - перечисление доступных баз данных. Возвращается массив объектов ``Database`` (см. описание выше).

```json
[
  {
    "name": "ISTU",
    "description": "Учебники, монографии и продолжающиеся издания"
  },
  {
    "name": "NTD",
    "description": "Нормативно-техническая документация"
  },
  {
    "name": "USO",
    "description": "Литература в филиалах ИРНИТУ"
  }
]
```

* ``GET scenarios/{database}`` - перечисление доступных сценариев поиска для указанной базы. Возвращается массив объектов ``Scenario`` (см. выше).

```json
[
  {
    "prefix": "A=",
    "description": "Автор"
  },
  {
    "prefix": "T=",
    "description": "Заглавие"
  },
  {
    "prefix": "K=",
    "description": "Ключевое слово"
  }
]
```

* ``GET readers/{ticket}`` - поиск читателя по номеру его билета. Возвращается объект ``Reader`` для найденного читателя (см. выше) либо код 403.

```json
{
  "ticket": "00003",
  "name": "Репин Илья Ефимович",
  "mail": "repin1844@gmail.com",
  "loans": [
    {
      "instance": {
        "db": "ISTU",
        "book": "L711",
        "number": "B6103"
      },
      "description": "Сагалович М. В. По следам Фернана Леже. — М.: Советский художник, 1983. — 352 с. — (Рассказы о художниках)",
      "date": "2024-09-01T00:00:00+08:00",
      "deadline": "2024-10-01T00:00:00+08:00",
      "prolongation": 0
    }
  ]
}
```

* ``GET search/{database}/{query}`` - поиск книг в электронном каталоге. Возвращается массив объектов ``Book`` (см. выше).

```json
[
  {
    "id": "K1/2",
    "description": "Паустовский, Константин. Исаак Левитан : повесть. — М., 1937",
    "exemplars": [
      {
        "number": "A6001",
        "status": "0"
      },
      {
        "number": "A60002",
        "status": "6"
      }
    ]
  },
  {
    "id": "K2/3",
    "description": "Федоров-Давыдов, А. А. И. И. Левитан. Жизнь и творчество. — М., 1960",
    "exemplars": [
      {
        "number": "A6003",
        "status": "0"
      },
      {
        "number": "A60004",
        "status": "2"
      }
    ]
  }
]
```

* ``GET orders`` - перечисление всех заказов. Возвращается массив объектов ``Order`` (см. выше).

```json
[
  {
    "id": 1,
    "ticket": "123",
    "instance": {
      "db": "ISTU",
      "book": "V1/2",
      "number": "W0001"
    },
    "date": "2024-01-01T00:00:00+08:00",
    "status": "new"
  },
  {
    "id": 2,
    "ticket": "124",
    "instance": {
      "db": "ISTU",
      "book": "V2/3",
      "number": "W0002"
    },
    "date": "2024-01-02T00:00:00+08:00",
    "status": "done"
  }
]
```

* ``POST orders`` - создание нового заказа и помещение его в очередь. Объект ``Order`` (см. выше) должен быть передан в теле запроса в формате JSON:

```json
{
  "id": 0,
  "ticket": "T0002",
  "instance": {
    "db": "ISTU",
    "book": "B01/23",
    "number": "X001"
  },
  "date": "2024-10-01T03:27:48.999Z",
  "status": "new"
}
```

* ``GET orders/status/{status}`` - перечисление всех заказов с указанным статусом. Возвращается массив объектов ``Order``.

```json
[
  {
    "id": 1,
    "ticket": "123",
    "instance": {
      "db": "ISTU",
      "book": "V1/2",
      "number": "W0001"
    },
    "date": "2024-01-01T00:00:00+08:00",
    "status": "new"
  },
  {
    "id": 7,
    "ticket": "130",
    "instance": {
      "db": "ISTU",
      "book": "R2/3",
      "number": "R0002"
    },
    "date": "2024-01-02T00:00:00+08:00",
    "status": "new"
  }
]
```

* ``GET orders/ticket/{ticket}`` - перечисление всех заказов для указанного номера читательского билета. Возвращается массив объектов ``Order``.

```json
[
  {
    "id": 4,
    "ticket": "126",
    "instance": {
      "db": "ISTU",
      "book": "V4/5",
      "number": "W0004"
    },
    "date": "2024-01-04T00:00:00+08:00",
    "status": "cancelled"
  },
  {
    "id": 5,
    "ticket": "126",
    "instance": {
      "db": "ISTU",
      "book": "V55/65",
      "number": "X0005"
    },
    "date": "2024-01-05T00:00:00+08:00",
    "status": "error"
  }
]
```

* ``PUT orders/status/{id}/{status}`` - установка нового статуса для указанного заказа.

* ``DELETE orders/{id}`` - удаление заказа с указанным идентификатором.
