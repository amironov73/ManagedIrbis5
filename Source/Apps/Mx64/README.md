# Mx64

Универсальный консольный клиент ИРБИС64, "швейцарский нож" для ИРБИС64.
Эта утилита позволяет с командной строки производить самые разнообразные операции над базами данных ИРБИС64.

## Формат файла

Каждая команда в файле занимает одну строчку. Пустые строки игнорируются. Строки, начинающиеся с #, считаются комментариями и игнорируются.

### Структура строки

&lt;command&gt; [arguments] [handler]*

command - собственно команда, например, connect.

arguments - аргументы команды, например, host=127.0.0.1. Количество
и формат аргументов зависят от конкретной команды.

handler - обработчики (см.).

## Команды

### connect

**Синтаксис**: connect \[connectionString\]

Подключение к серверу ИРБИС64 с помощью указанной строки подключения. Если строка не задана, используется значение по умолчанию из `appconfig.json`.

В любой момент времени активно не более одного соединения с сервером. Попытка подключиться к новому серверу вызовет автоматическое отключение от предыдущего.

### disconnect

**Синтаксис**: disconnect

Отключение от сервера. Если подключения не было, ошибки не возникает.

### reconnect

**Синтаксис**: reconnect

Переподключение к серверу.

### exit

**Синтаксис**: exit

Завершение работы интерпретатора. Если было установлено подключение к серверу, оно отключается.

### db

**Синтаксис**: db [name]

Смена текущей базы данных.

Если имя базы не указано, то на консоль выводится имя текущей базы и её объем.

### pushDb

Запоминание текущей базы данных.

### popDb

Восстановление текущей базы данных.

### search

**Синтаксис**: search &lt;expression&gt;

Поиск по словарю с использованием указанного выражения.

### limit

**Синтаксис**: limit &lt;expression&gt;

Ограничение числа найденных записей.

### filter

**Синтаксис**: filter &lt;expression&gt;

Последовательный поиск (в памяти клиента) с использованием указанного выражения.

### list

**Синтаксис**: list

Список найденных записей (MFN, результат расформатирования).

### include

**Синтаксис**: include &lt;expression&gt;

Добавление указанных MFN в список. Можно указать имя файла, тогда записи из файла добавятся к текущим.

### exclude

**Синтаксис**: exclude &lt;expression&gt;

Удаление указанных MFN из списка. Можно указать имя файла, тогда записи из файла вычтутся из текущих.

### refine

**Синтаксис**: refine &lt;expression&gt;

Уточнение предыдущего поиска.

### history

**Синтаксис**: history [expression]

История поиска. Возвращение к предыдущему поиску.

### format

**Синтаксис**: format &lt;expression&gt;

Установка формата вывода. По умолчанию используется формат @brief.

### sort

**Синтаксис**: sort &lt;expression&gt;

Установка сортировки. Чтобы отменить сортировку, необходимо указать "sort off".

По умолчанию сортировка не применяется (записи выдаются в том порядке, в котором их вернул сервер)

### print

**Синтаксис**: print [fileName]

Вывод на экран (или в файл) найденных записей.

Можно специфицировать вывод на принтер.

### export

**Синтаксис**: export &lt;fileName&gt;

Экспорт найденных записей в указанный файл. Формат файла определяется
автоматически по его расширению. Файлы с неизвестными расширениями
считаются текстовыми.

### import

**Синтаксис**: import &lt;fileName&gt;

Импорт записей из указанного файла. Формат файла определяется автоматически
по его расширению. Файлы с неизвестными расширениями считаются текстовыми.

### delete

**Синтаксис**: delete [expression]

Удаление указанных либо найденных записей.

### createDb

**Синтаксис**: createDb &lt;name&gt;

Создание базы данных.

### dropDb

**Синтаксис**: dropDb &lt;name&gt;

Удаление базы данных.

### truncateDb

**Синтаксис**: truncate &lt;name&gt;

Опустошение базы данных.

### gbl

**Синтаксис**: gbl &lt;fileName&gt;

Глобальная корректировка из указанного файла (локального или
удалённого).

### dir

**Синтаксис**: dir &lt;mask&gt;

Список файлов по маске.

### type

**Синтаксис**: type &lt;mask&gt;

Вывод на экран содержимого файла на сервере.

### remote

**Синтаксис**: remote &lt;command&gt;

Выполнение команды удалённо (на сервере ИРБИС64).

### local

**Синтаксис**: local &lt;command&gt;

Выполнение команды локально.

### download

**Синтаксис**: download &lt;fileName&gt;

Скачивание файла с сервера.

### upload

**Синтаксис**: upload &lt;fileName&gt;

Загрузка файла на сервер.

### unlock

**Синтаксис**: unlock &lt;expression&gt;

Разблокировать базу данных или записи.

где expression:

- db - текущая база данных;
- name - указанная база данных;
- all - все записи во всех базах данных;
- 1,2,3 - указанные записи;

### lock

**Синтаксис**: lock &lt;expression&gt;

Заблокировать базу данных или записи по аналогии с unlock.

### actualize

**Синтаксис**: actualize &lt;expression&gt;

Актуализировать базу данных или указанные записи.

### quiet

**Синтаксис**: quiet

Установка минимального уровня "болтливости".

### verbose

**Синтаксис**: verbose &lt;level&gt;

### pft

**Синтаксис**: pft &lt;expression&gt;

Выполнение строчки PFT.

### pftFile

**Синтаксис**: pftFile &lt;fileName&gt;

Выполнение PFT.

### cs

**Синтаксис**: cs &lt;expression&gt;

Выполнение строчки C#.

### csfile

**Синтаксис**: csfile &lt;fileName&gt;

Выполнение файла C#.

### mx

**Синтаксис**: mx &lt;fileName&gt;

Выполнение вложенного скрипта из файла.

### alias

**Синтаксис**: alias [expression]

Создание алиаса / просмотр алиасов. Алиасы
сохраняются в файл автоматически.

### store

**Синтаксис**: store &lt;fileName&gt;

Сохранение списка найденных записей в указанный файл.

### load

**Синтаксис**: load &lt;fileName&gt;

Загрузка списка найденных записей из указанного файла.

### ping

**Синтаксис**: ping [repeat]

Пустая операция. Выводит время раунд-трипа. Можно указать
число повторений.

### ver

**Синтаксис**: ver

Вывод версии ИРБИС-сервера.

### addUser

**Синтаксис**: addUser &lt;expression&gt;

Создание пользователя.

### delUser

**Синтаксис**: delUser &lt;name&gt;

Удаление пользователя

### listUsers

**Синтаксис**: listUsers

Получение списка пользователей.

### listDb

**Синтаксис**: listDb [menuFile]

Получение списка баз данных

### info

**Синтаксис**: info

Получение информации о сервере: нагрузка и проч.

### restart

**Синтаксис**: restart

Перезапуск сервера

### cls

**Синтаксис**: cls

Очистка экрана.

### if

**Синтаксис**: if &lt;expression&gt;
...
[else]
...
fi

### while

**Синтаксис**: while &lt;expression&gt;
...
end

## Переменные

### $db

Имя текущей базы данных.

### $count

Количество найденных записей.

## Обработчики

**&gt;** - перенаправление вывода в файл (перезапись файла).
**&gt;&gt;** - перенаправление вывода в файл (добавление в конец файла).
**&lt;** - перенаправление ввода из файла.

Опции:

- **-ansi** - кодировка ANSI.
- **-oem** - кодировка OEM.
- **-utf8** - кодировка UTF8.
- **-utf16** - кодировка UTF16.
- **-safe** - не перезаписывать существующий файл (генерируется исключение).

**&gt;!** - перенаправление вывода в переменную.
**&lt;!** - перенаправление ввода из переменной.

**&gt;@** - перенаправление вывода в почту.

Опции:

- **-ansi** - кодировка ANSI.
- **-oem** - кодировка OEM.
- **-utf8** - кодировка UTF8.
- **-utf16** - кодировка UTF16.
- **-to:address@host** - адресат.
- **-title:title** - заголовок сообщения.

**&gt;* ** - вывод на принтер.

Опции:

- **-size:paperSize** - размер бумаги.
- **-name:printerName** - имя принтера.

**&gt;|** - динамический обработчик.

Примеры:

- **textview** - просмотр текста.
- **textedit** - редактирование текста.
- **recordlist** - просмотр списка записей.
- **recordview** - просмотр записи.
- **recordedit** - редактирование записи.

**&lt;?** - ввод с клавиатуры.


